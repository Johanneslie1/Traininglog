import{j as e,u as A,i as R,k as O}from"./index-hOws252K.js";import{b as t,h as I}from"./react-vendor-DQubVtpq.js";import{E as P,a as L}from"./ExerciseSetLogger-pKgiY5C4.js";import{j as W}from"./firebase-vendor-D8cnFtZG.js";import"./CreateExerciseDialog-D-vEJcPb.js";import"./auth-CK7XJJ2I.js";const z=({onClose:i,onSave:u,initialExercises:b=[]})=>{const[a,r]=t.useState("main"),[v,x]=t.useState(b),[c,f]=t.useState(null),h=t.useCallback(l=>{const w=l.id||`temp-${Date.now()}`;f({...l,id:w,sets:[]}),r("setLogger")},[]),y=t.useCallback(l=>{c&&(x(w=>[...w,{...c,sets:l}]),f(null),r("main"))},[c]),p=l=>{x(w=>w.filter(k=>k.id!==l))},m=l=>{l.preventDefault(),u(v)};return a==="search"?e.jsx(P,{onClose:()=>r("main"),onSelectExercise:h}):a==="setLogger"&&c?e.jsx(L,{exercise:c,onSave:y,onCancel:()=>r("main")}):e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Exercises"}),v.length===0&&e.jsx("div",{className:"text-gray-500",children:"No exercises added yet."}),e.jsx("ul",{children:v.map((l,w)=>e.jsxs("li",{className:"flex items-center gap-2 text-gray-200 text-sm mb-1",children:[l.name," - ",l.sets.length," sets",e.jsx("button",{type:"button",onClick:()=>p(l.id),className:"ml-2 text-red-400",children:"Remove"})]},l.id||w))}),e.jsx("button",{type:"button",onClick:()=>r("search"),className:"px-3 py-1 bg-blue-700 text-white rounded",children:"Add Exercise"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 bg-gray-700 text-white rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Save"})]})]})},B=({onClose:i,onSave:u})=>{const[b,a]=t.useState("search"),[r,v]=t.useState(null),[x,c]=t.useState([]),[f,h]=t.useState(null),y=t.useCallback(m=>{try{v({...m,id:crypto.randomUUID(),sets:[]}),c([]),a("setLogger"),h(null)}catch(l){h("Failed to add exercise. Please try again."),console.error("Error adding exercise:",l)}},[]),p=t.useCallback(m=>{if(r)try{c(m),u({...r,sets:m})}catch(l){h("Failed to save exercise. Please try again."),console.error("Error saving exercise:",l)}},[r,u]);return b==="search"?e.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg w-full max-w-4xl flex flex-col h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-medium text-white",children:"Add Exercise"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),f&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 m-4 rounded-lg",children:e.jsx("p",{className:"text-red-500",children:f})}),e.jsx(P,{onClose:i,onSelectExercise:y})]})}):b==="setLogger"&&r?e.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg w-full max-w-4xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-medium text-white",children:r.name}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>a("search"),className:"text-gray-400 hover:text-white transition-colors",children:"Change Exercise"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),r.description&&e.jsx("p",{className:"mt-2 text-gray-400",children:r.description})]}),f&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 mx-4 mt-4 rounded-lg",children:e.jsx("p",{className:"text-red-500",children:f})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(L,{exercise:r,onSave:p,onCancel:i,showPreviousSets:!0,isEditing:!1,previousSet:x.length>0?x[x.length-1]:void 0})})]})}):null},F=({isOpen:i,onClose:u,onSave:b,initialData:a})=>{const[r,v]=t.useState((a==null?void 0:a.name)||""),[x,c]=t.useState((a==null?void 0:a.exercises.map(o=>({id:o.id,name:o.name,description:"",type:"strength",category:"compound",primaryMuscles:[],secondaryMuscles:[],defaultUnit:"kg",metrics:{trackWeight:!0,trackReps:!0},instructions:[],sets:Array(o.sets).fill({reps:o.reps,weight:o.weight||0,difficulty:"MODERATE"})})))||[]),[f,h]=t.useState(!1),[y,p]=t.useState(!1),[m,l]=t.useState(null),w=t.useCallback(()=>{var d;const o=W();if(!((d=o.currentUser)!=null&&d.uid))throw new Error("User must be logged in to perform this action");return o.currentUser.uid},[]),k=o=>{c(d=>[...d,o]),p(!1)},s=o=>{m!==null&&(c(d=>d.map((N,S)=>S===m?{...N,sets:o}:N)),l(null))},n=o=>{c(o),h(!1)},j=o=>{if(o.preventDefault(),!!r)try{const d=w();console.log("[SessionModal] Creating/updating session:",{isEdit:!!a,name:r,exerciseCount:x.length});const N=x.map(g=>{var E,M;return{id:g.id||"",name:g.name,sets:g.sets.length||3,reps:((E=g.sets[0])==null?void 0:E.reps)||10,weight:((M=g.sets[0])==null?void 0:M.weight)||0,setsData:g.sets.map(C=>({reps:C.reps||10,weight:typeof C.weight=="number"?C.weight:0,difficulty:C.difficulty||"MODERATE"}))}}),S={id:(a==null?void 0:a.id)||"",name:r,exercises:N,userId:d,order:(a==null?void 0:a.order)??0};console.log("[SessionModal] Saving session:",S),b(S),v(""),c([]),u()}catch(d){console.error("[SessionModal] Error saving session:",d),alert(d instanceof Error?d.message:"Failed to save session")}};return i?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50",children:[e.jsxs("form",{onSubmit:j,className:"bg-[#23272F] p-6 rounded-lg w-full max-w-sm shadow-lg",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-white",children:"Add Session"}),e.jsx("input",{className:"w-full mb-3 px-3 py-2 rounded bg-[#181A20] text-white border border-white/10",placeholder:"Session Name",value:r,onChange:o=>v(o.target.value),required:!0}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-white mb-2",children:"Exercises"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>p(!0),className:"px-3 py-1 bg-green-700 text-white rounded",children:"Add Exercise"}),e.jsx("button",{type:"button",onClick:()=>h(!0),className:"px-3 py-1 bg-blue-700 text-white rounded",children:"Edit All"})]}),x.length===0&&e.jsx("div",{className:"text-gray-500",children:"No exercises added yet."}),e.jsx("ul",{children:x.map((o,d)=>e.jsxs("li",{className:"text-gray-200 text-sm mb-1 flex items-center gap-2",children:[o.name," - ",o.sets.length," sets",e.jsx("button",{type:"button",className:"text-blue-400 ml-2",onClick:()=>l(d),children:"Edit"}),e.jsx("button",{type:"button",className:"text-red-400 ml-2",onClick:()=>c(N=>N.filter((S,g)=>g!==d)),children:"Remove"})]},o.id||d))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 bg-gray-700 text-white rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Save"})]})]}),f&&e.jsxs(e.Fragment,{children:[typeof m=="number"&&x[m]&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-60",children:e.jsx("div",{className:"bg-[#23272F] p-6 rounded-lg w-full max-w-md shadow-lg",children:e.jsx(L,{exercise:x[m],onSave:s,onCancel:()=>l(null)})})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-60",children:e.jsx("div",{className:"bg-[#23272F] p-6 rounded-lg w-full max-w-md shadow-lg",children:e.jsx(z,{initialExercises:x,onSave:n,onClose:()=>h(!1)})})})]}),y&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-60",children:e.jsx("div",{className:"bg-[#23272F] p-6 rounded-lg w-full max-w-md shadow-lg",children:e.jsx(B,{onSave:k,onClose:()=>p(!1)})})})]}):null};function T(i,u){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:u},i),t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"}))}const $=t.forwardRef(T);function D(i,u){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:u},i),t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"}))}const U=t.forwardRef(D);function H(i,u){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:u},i),t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"}))}const V=t.forwardRef(H),X=({program:i,onBack:u,onUpdate:b,selectionMode:a=!1})=>{const r=i.sessions??[],[v,x]=t.useState(!1),[c,f]=t.useState(null),[h,y]=t.useState([]),[,p]=t.useState(!1),{updateSessionInProgram:m}=A();I.useEffect(()=>{let s;return r.length===0&&(p(!0),s=setTimeout(()=>{p(!1)},2e3)),()=>{s&&clearTimeout(s)}},[r.length]);const l=t.useCallback(s=>{y(n=>n.includes(s)?n.filter(j=>j!==s):[...n,s])},[]),w=t.useCallback(async s=>{if(window.confirm("Are you sure you want to delete this session?"))try{console.log("[ProgramDetail] Deleting session:",s),await R(i.id,s),console.log("[ProgramDetail] Session deleted from Firestore");const n=r.filter(j=>j.id!==s);b({...i,sessions:n}),console.log("[ProgramDetail] Local state updated after session deletion")}catch(n){console.error("Error deleting session:",n),alert(n instanceof Error?n.message:"Failed to delete session. Please try again.")}},[i,r,b]),k=t.useCallback(async s=>{try{if(p(!0),console.log("[ProgramDetail] Starting session save:",{sessionId:s.id,sessionName:s.name,isEdit:!!c,exerciseCount:s.exercises.length}),c){console.log("[ProgramDetail] Updating existing session via updateSession service"),await m(i.id,s.id,s.exercises);const n=r.map(j=>j.id===s.id?{...s,order:j.order}:j);b({...i,sessions:n}),console.log("[ProgramDetail] Local state updated for existing session")}else{console.log("[ProgramDetail] Creating new session via createSession service");const n=r.map(g=>g.order??0),j=n.length>0?Math.max(...n)+1:0,o={name:s.name,exercises:s.exercises.map(g=>({...g,id:g.id||void 0})),order:j},d=await O(i.id,o);console.log("[ProgramDetail] New session created in Firestore with ID:",d);const N={...s,id:d,order:j},S=[...r,N].sort((g,E)=>(g.order??0)-(E.order??0));b({...i,sessions:S}),console.log("[ProgramDetail] Local state updated with new session")}x(!1),f(null),h.includes(s.id)||y(n=>[...n,s.id])}catch(n){console.error("[ProgramDetail] Error saving session:",n),alert(n instanceof Error?n.message:"Failed to save session. Please try again.")}finally{p(!1)}},[i,r,b,c,m,h]);return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:i.name}),e.jsx("p",{className:"text-gray-400 mt-1",children:i.description})]}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[r.length>0?r.map(s=>e.jsxs("div",{className:"bg-[#1a1a1a] rounded-xl overflow-hidden shadow-lg border border-white/5",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#2a2a2a] to-[#222] px-6 py-4 flex items-center justify-between border-b border-white/5",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[s.name,e.jsxs("span",{className:"text-sm font-normal text-gray-400 bg-black/20 px-2 py-0.5 rounded-full",children:[s.exercises.length," exercises"]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[!a&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f(s),className:"p-2 hover:bg-black/20 rounded-lg transition-colors text-blue-400 hover:text-blue-300",title:"Edit session",children:e.jsx(U,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>w(s.id),className:"p-2 hover:bg-black/20 rounded-lg transition-colors text-red-400 hover:text-red-300",title:"Delete session",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>l(s.id),className:"p-2 hover:bg-black/20 rounded-lg transition-colors",title:h.includes(s.id)?"Collapse session":"Expand session",children:e.jsx($,{className:`w-5 h-5 text-gray-400 transition-transform duration-200 ${h.includes(s.id)?"rotate-180":""}`})})]})]}),h.includes(s.id)&&e.jsx("div",{className:"divide-y divide-white/5",children:s.exercises.map(n=>e.jsx("div",{className:"px-6 py-4 hover:bg-white/5 transition-colors",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:n.name}),e.jsxs("div",{className:"text-sm text-gray-400 mt-1",children:[n.sets," sets Ã— ",n.reps," reps",typeof n.weight=="number"&&n.weight>0&&` @ ${n.weight}kg`]})]})})},n.id))})]},s.id)):e.jsx("div",{className:"text-gray-500",children:"No sessions yet."}),!a&&e.jsxs("button",{onClick:()=>x(!0),className:"mt-4 w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Session"]})]}),e.jsx(F,{isOpen:v,onClose:()=>x(!1),onSave:k}),c&&e.jsx(F,{isOpen:!0,onClose:()=>f(null),onSave:k,initialData:c})]})};export{X as default};
//# sourceMappingURL=ProgramDetail-jB9sQdfZ.js.map
