import{j as e,k as H,m as V,n as R,o as q}from"./index-BW4wnaLN.js";import{b as o,h as G}from"./react-vendor-DOxSmbpi.js";import{d as J}from"./ExerciseHistoryPicker-mDNrnu8A.js";import{j as K}from"./firebase-vendor-CDzPPbaT.js";import{F as D,b as Q,P as X,S as Y}from"./ProgramBuilder-BzEeHDp7.js";import"./useAuth-Bl_XYtwH.js";import"./speedAgility-DxCoHWLB.js";function Z(t,c){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:c},t),o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"}))}const ee=o.forwardRef(Z);function se(t,c){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:c},t),o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"}))}const re=o.forwardRef(se);function te(t,c){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:c},t),o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}))}const oe=o.forwardRef(te),ne=({onClose:t,onSave:c})=>{const h=o.useCallback(l=>{try{const n={...l,id:crypto.randomUUID(),sets:[]};c(n)}catch(n){console.error("Error adding exercise:",n)}},[c]);return e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[e.jsxs("header",{className:"flex items-center justify-between px-4 py-4 bg-black/95 backdrop-blur-sm border-b border-white/10",children:[e.jsx("h1",{className:"text-white text-xl font-medium",children:"Add Exercise"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("main",{className:"flex-1 overflow-hidden",children:e.jsx(J,{onClose:t,onSelectExercise:h})})]})},O=({isOpen:t,onClose:c,onSave:h,initialData:l})=>{const[n,N]=o.useState((l==null?void 0:l.name)||""),[w,E]=o.useState((l==null?void 0:l.exercises.map(a=>({id:a.id,name:a.name,description:"",type:"strength",category:"compound",primaryMuscles:[],secondaryMuscles:[],defaultUnit:"kg",metrics:{trackWeight:!0,trackReps:!0},instructions:[],sets:[]})))||[]),[v,k]=o.useState(!1),C=o.useCallback(()=>{var i;const a=K();if(!((i=a.currentUser)!=null&&i.uid))throw new Error("User must be logged in to perform this action");return a.currentUser.uid},[]),m=a=>{E(i=>[...i,a]),k(!1)},f=a=>{E(i=>i.filter((y,p)=>y.id!==a&&p.toString()!==a))},b=a=>{if(a.preventDefault(),!!n)try{const i=C();console.log("[SessionModal] Creating/updating session:",{isEdit:!!l,name:n,exerciseCount:w.length});const y=w.map(x=>{var L,M;return{id:x.id||"",name:x.name,sets:x.sets.length||3,reps:((L=x.sets[0])==null?void 0:L.reps)||10,weight:((M=x.sets[0])==null?void 0:M.weight)||0,setsData:x.sets.map(S=>({reps:S.reps||10,weight:typeof S.weight=="number"?S.weight:0,difficulty:S.difficulty||"MODERATE"}))}}),p={id:(l==null?void 0:l.id)||"",name:n,exercises:y,userId:i,order:(l==null?void 0:l.order)??0};console.log("[SessionModal] Saving session:",p),h(p),N(""),E([]),c()}catch(i){console.error("[SessionModal] Error saving session:",i),alert(i instanceof Error?i.message:"Failed to save session")}};return t?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50",children:[e.jsxs("form",{onSubmit:b,className:"bg-[#23272F] p-6 rounded-lg w-full max-w-sm shadow-lg",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-white",children:"Add Session"}),e.jsx("input",{className:"w-full mb-3 px-3 py-2 rounded bg-[#181A20] text-white border border-white/10",placeholder:"Session Name",value:n,onChange:a=>N(a.target.value),required:!0}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-white text-lg font-medium mb-3",children:"Exercises"}),e.jsx("button",{type:"button",onClick:()=>k(!0),className:"w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors mb-4",children:"Add Exercise"}),w.length===0?e.jsx("div",{className:"text-gray-400 text-center py-4 bg-gray-800 rounded-lg",children:"No exercises added yet"}):e.jsx("div",{className:"space-y-2",children:w.map((a,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-200 font-medium",children:a.name}),e.jsx("button",{type:"button",onClick:()=>f(a.id||i.toString()),className:"text-red-400 hover:text-red-300 transition-colors",children:"Remove"})]},a.id||i))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 bg-gray-700 text-white rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Save"})]})]}),v&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-60",children:e.jsx("div",{className:"bg-[#23272F] p-6 rounded-lg w-full max-w-md shadow-lg",children:e.jsx(ne,{onSave:m,onClose:()=>k(!1)})})})]}):null},he=({program:t,onBack:c,onUpdate:h,selectionMode:l=!1})=>{const n=t.sessions??[],[N,w]=o.useState(!1),[E,v]=o.useState(!1),[k,C]=o.useState(!1),[m,f]=o.useState(null),[b,a]=o.useState([]),[,i]=o.useState(!1),[y,p]=o.useState(!1),{updateSessionInProgram:x,deleteProgram:L,updateProgram:M}=H();G.useEffect(()=>{let s;return n.length===0&&(i(!0),s=setTimeout(()=>{i(!1)},2e3)),()=>{s&&clearTimeout(s)}},[n.length]);const S=o.useCallback(s=>{a(r=>r.includes(s)?r.filter(d=>d!==s):[...r,s])},[]),B=o.useCallback(async s=>{if(window.confirm("Are you sure you want to delete this session?"))try{console.log("[ProgramDetail] Deleting session:",s),await V(t.id,s),console.log("[ProgramDetail] Session deleted from Firestore");const r=n.filter(d=>d.id!==s);h({...t,sessions:r}),console.log("[ProgramDetail] Local state updated after session deletion")}catch(r){console.error("Error deleting session:",r),alert(r instanceof Error?r.message:"Failed to delete session. Please try again.")}},[t,n,h]),I=o.useCallback(async s=>{try{if(i(!0),console.log("[ProgramDetail] Starting session save:",{sessionId:s.id,sessionName:s.name,isEdit:!!m,exerciseCount:s.exercises.length}),m){console.log("[ProgramDetail] Updating existing session via updateSession service"),await x(t.id,s.id,s.exercises);const r=n.map(d=>d.id===s.id?{...s,order:d.order}:d);h({...t,sessions:r}),console.log("[ProgramDetail] Local state updated for existing session")}else{console.log("[ProgramDetail] Creating new session via createSession service");const r=n.map(g=>g.order??0),d=r.length>0?Math.max(...r)+1:0,j={name:s.name,exercises:s.exercises.map(g=>({id:g.id||void 0,name:g.name,notes:g.notes,order:g.order})),order:d},F=await R(t.id,j);console.log("[ProgramDetail] New session created in Firestore with ID:",F);const A={...s,id:F,order:d},P=[...n,A].sort((g,u)=>(g.order??0)-(u.order??0));h({...t,sessions:P}),console.log("[ProgramDetail] Local state updated with new session")}w(!1),f(null),b.includes(s.id)||a(r=>[...r,s.id])}catch(r){console.error("[ProgramDetail] Error saving session:",r),alert(r instanceof Error?r.message:"Failed to save session. Please try again.")}finally{i(!1)}},[t,n,h,m,x,b]),T=async()=>{if(window.confirm(`Are you sure you want to delete the program "${t.name}"? This will delete all sessions and exercises. This action cannot be undone.`)){p(!0);try{console.log("[ProgramDetail] Deleting program:",t.id),await L(t.id),console.log("[ProgramDetail] Program deleted successfully"),c()}catch(s){console.error("[ProgramDetail] Error deleting program:",s),alert(s instanceof Error?s.message:"Failed to delete program. Please try again.")}finally{p(!1)}}},$=()=>{C(!0)},W=async s=>{try{const r={...t,...s,updatedAt:new Date().toISOString()};await M(t.id,r),h(r),C(!1)}catch(r){console.error("[ProgramDetail] Error updating program:",r),alert(r instanceof Error?r.message:"Failed to update program. Please try again.")}},_=s=>{f(s),v(!0)},z=async s=>{try{if(i(!0),m){const r={...s,id:m.id,userId:m.userId};await x(t.id,m.id,r.exercises);const d=n.map(j=>j.id===m.id?r:j);h({...t,sessions:d})}else{const r=await q(()=>import("./firebase-vendor-CDzPPbaT.js").then(u=>u.H),[]).then(u=>u.getAuth().currentUser);if(!r)throw new Error("User must be logged in");const d={...s,userId:r.uid},j=Math.max(...n.map(u=>u.order??0),0)+1,F={...d,exercises:d.exercises.map(u=>({...u,id:u.id||void 0})),order:j},A=await R(t.id,F),P={...d,id:A,order:j},g=[...n,P].sort((u,U)=>(u.order??0)-(U.order??0));h({...t,sessions:g}),b.includes(P.id)||a(u=>[...u,P.id])}v(!1),f(null)}catch(r){console.error("[ProgramDetail] Error saving session:",r),alert(r instanceof Error?r.message:"Failed to save session. Please try again.")}finally{i(!1)}};return e.jsx("div",{className:"min-h-screen bg-black/90 text-white",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("header",{className:"sticky top-0 flex items-center justify-between p-4 bg-[#1a1a1a] border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:c,className:"p-2 hover:bg-white/10 rounded-xl transition-all duration-200",children:e.jsx(ee,{className:"w-5 h-5 text-gray-300"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-white",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-0.5",children:t.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:!l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:$,className:"p-2.5 hover:bg-gray-800/60 rounded-xl transition-all duration-200 text-blue-400 hover:text-blue-300",title:"Edit program","aria-label":`Edit program ${t.name}`,children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:T,disabled:y,className:"p-2.5 hover:bg-gray-800/60 rounded-xl transition-all duration-200 text-red-400 hover:text-red-300 disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete program","aria-label":`Delete program ${t.name}`,children:y?e.jsx("div",{className:"w-5 h-5 border-2 border-red-400 border-t-transparent rounded-full animate-spin"}):e.jsx(D,{className:"w-5 h-5"})})]})})]}),e.jsx("main",{className:"flex-1 overflow-y-auto overscroll-contain pb-safe min-h-0 p-6",children:e.jsxs("div",{className:"space-y-3",children:[n.length>0?n.map(s=>e.jsxs("div",{className:"bg-[#1a1a1a] rounded-2xl overflow-hidden border border-gray-800 hover:border-gray-700 transition-all duration-200",children:[e.jsxs("div",{className:"px-5 py-4 flex items-center justify-between border-b border-gray-800/50",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:s.name}),e.jsxs("span",{className:"text-xs font-medium text-gray-400 bg-gray-800/60 px-2.5 py-1 rounded-full",children:[s.exercises.length," exercises"]})]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>_(s),className:"p-2 hover:bg-gray-800/60 rounded-xl transition-all duration-200 text-blue-400 hover:text-blue-300",title:"Edit session",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>B(s.id),className:"p-2 hover:bg-gray-800/60 rounded-xl transition-all duration-200 text-red-400 hover:text-red-300",title:"Delete session",children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>S(s.id),className:"p-2 hover:bg-gray-800/60 rounded-xl transition-all duration-200",title:b.includes(s.id)?"Collapse session":"Expand session",children:e.jsx(re,{className:`w-4 h-4 text-gray-400 transition-transform duration-200 ${b.includes(s.id)?"rotate-180":""}`})})]})]}),b.includes(s.id)&&e.jsx("div",{className:"p-1",children:s.exercises.map((r,d)=>e.jsx("div",{className:`px-4 py-3 hover:bg-gray-800/40 transition-all duration-200 rounded-xl mx-1 ${d!==s.exercises.length-1?"mb-1":""}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-medium text-white",children:r.name}),e.jsx("div",{className:"text-sm text-gray-400 mt-0.5",children:"Sets and reps will be logged during workout"})]})})},r.id))})]},s.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl bg-gray-800/50 flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No sessions yet"}),e.jsx("p",{className:"text-gray-400 text-sm mb-6",children:"Create your first training session to get started"})]}),!l&&e.jsxs("button",{onClick:()=>{f(null),v(!0)},className:"w-full py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-2xl hover:from-blue-700 hover:to-blue-800 transition-all duration-200 flex items-center justify-center gap-3 font-medium shadow-lg hover:shadow-xl border border-blue-500/20",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add New Session"]})]})}),k&&e.jsx(X,{onClose:()=>C(!1),onSave:W,initialProgram:t}),E&&e.jsx(Y,{onClose:()=>{v(!1),f(null)},onSave:z,initialSession:m||void 0}),e.jsx(O,{isOpen:N,onClose:()=>w(!1),onSave:I}),m&&N&&e.jsx(O,{isOpen:!0,onClose:()=>f(null),onSave:I,initialData:m})]})})};export{he as default};
//# sourceMappingURL=ProgramDetail-sV_Px1nl.js.map
