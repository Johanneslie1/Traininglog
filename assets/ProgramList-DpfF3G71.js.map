{"version":3,"file":"ProgramList-DpfF3G71.js","sources":["../../src/features/programs/ProgramList.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { usePrograms } from '@/context/ProgramsContext';\r\nimport ProgramModal from './ProgramModal';\r\nimport { getAuth } from 'firebase/auth';\r\nimport { Program } from '@/types/program';\r\nimport { ErrorBoundary } from '@/components/ErrorBoundary';\r\nimport { TrashIcon } from '@heroicons/react/outline';\r\n\r\nconst levelColors: Record<string, string> = {\r\n  Any: 'bg-gray-500',\r\n  Beginner: 'bg-green-600',\r\n  Intermediate: 'bg-yellow-600',\r\n  Advanced: 'bg-red-600',\r\n};\r\n\r\nconst ProgramListContent: React.FC<{ onSelect?: (id: string) => void }> = ({ onSelect }) => {\r\n  const navigate = useNavigate();\r\n  const { programs, addProgram: create, refresh, deleteProgram } = usePrograms();\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [deletingProgramId, setDeletingProgramId] = useState<string | null>(null);\r\n  const auth = getAuth();\r\n\r\n  useEffect(() => {\r\n    if (auth.currentUser) {\r\n      try {\r\n        refresh();\r\n      } catch (error) {\r\n        console.error('Error refreshing programs:', error);\r\n        setError('Failed to load programs');\r\n      }\r\n    }\r\n  }, [auth.currentUser, refresh]);\r\n\r\n  const handleAdd = async (data: { name: string; level: string; description: string }) => {\r\n    setError(null);\r\n    const user = auth.currentUser;\r\n    if (!user) {\r\n      setError('You must be logged in to create a program');\r\n      return;\r\n    }\r\n\r\n    // Create program without fields that will be generated by backend\r\n    const newProgram = {\r\n      name: data.name,\r\n      description: data.description || '',\r\n      level: data.level.toLowerCase() as 'beginner' | 'intermediate' | 'advanced',\r\n      createdBy: user.uid,\r\n      sessions: [],\r\n      isPublic: false,\r\n      tags: [],\r\n      // Backend will generate these fields\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString()\r\n    } as Omit<Program, 'id' | 'userId'>;\r\n\r\n    console.log('[ProgramList] Creating new program:', newProgram);\r\n    \r\n    try {\r\n      await create(newProgram);\r\n      console.log('[ProgramList] Program created successfully');\r\n      setShowModal(false);\r\n      // Wait for programs to refresh and get the new program\r\n      await refresh();\r\n      // Find the newly created program\r\n      const createdProgram = programs.find(p => \r\n        p.name === data.name && \r\n        p.userId === user.uid &&\r\n        p.createdBy === user.uid\r\n      );\r\n      if (createdProgram) {\r\n        navigate(`/programs/${createdProgram.id}`);\r\n      } else {\r\n        // If we can't find it immediately, just stay on programs list\r\n        console.log('[ProgramList] Created program not found in list, staying on programs page');\r\n      }\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Failed to create program';\r\n      console.error('[ProgramList] Error in handleAdd:', err);\r\n      setError(errorMessage);\r\n    }\r\n  };\r\n\r\n  const handleDeleteProgram = async (programId: string, programName: string, event: React.MouseEvent) => {\r\n    event.stopPropagation(); // Prevent card click navigation\r\n    \r\n    if (window.confirm(`Are you sure you want to delete the program \"${programName}\"? This action cannot be undone.`)) {\r\n      setDeletingProgramId(programId);\r\n      setError(null);\r\n      \r\n      try {\r\n        console.log('[ProgramList] Deleting program:', programId);\r\n        await deleteProgram(programId);\r\n        console.log('[ProgramList] Program deleted successfully');\r\n        // Refresh the programs list\r\n        await refresh();\r\n      } catch (err) {\r\n        const errorMessage = err instanceof Error ? err.message : 'Failed to delete program';\r\n        console.error('[ProgramList] Error deleting program:', err);\r\n        setError(errorMessage);\r\n      } finally {\r\n        setDeletingProgramId(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative min-h-screen pb-20\">\r\n      <h2 className=\"text-xl font-bold mb-4\">Programs</h2>\r\n      {error && (\r\n        <div className=\"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      {programs.length === 0 ? (\r\n        <div className=\"text-center p-8 text-gray-500\">\r\n          No programs found. Click the + button to create one.\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-4\">\r\n          {programs.map((program: Program) => (\r\n            <div\r\n              key={program.id}\r\n              className=\"relative bg-[#23272F] rounded-xl p-4 flex flex-col items-start justify-between min-h-[120px] shadow-md cursor-pointer overflow-hidden group\"\r\n              onClick={() => (onSelect ? onSelect(program.id) : navigate(`/programs/${program.id}`))}\r\n            >\r\n              <div className=\"absolute right-3 top-3 opacity-20 text-5xl pointer-events-none select-none\">\r\n                <span role=\"img\" aria-label=\"kettlebell\">üèãÔ∏è‚Äç‚ôÇÔ∏è</span>\r\n              </div>\r\n              \r\n              {/* Delete button */}\r\n              <button\r\n                onClick={(e) => handleDeleteProgram(program.id, program.name, e)}\r\n                disabled={deletingProgramId === program.id}\r\n                className=\"absolute top-2 left-2 p-1.5 bg-red-600/80 hover:bg-red-500 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-all duration-200 z-20 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                title=\"Delete program\"\r\n                aria-label={`Delete program ${program.name}`}\r\n              >\r\n                {deletingProgramId === program.id ? (\r\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                ) : (\r\n                  <TrashIcon className=\"w-4 h-4\" />\r\n                )}\r\n              </button>\r\n\r\n              <div className=\"font-semibold text-lg text-white mb-1 z-10\">{program.name}</div>\r\n              <div className=\"flex items-center gap-2 z-10\">\r\n                <span className={`px-2 py-0.5 rounded text-xs text-white ${levelColors[program.level.charAt(0).toUpperCase() + program.level.slice(1)] || 'bg-gray-700'}`}>\r\n                  {program.level.charAt(0).toUpperCase() + program.level.slice(1)}\r\n                </span>\r\n                {program.sessions && program.sessions.length > 0 && (\r\n                  <span className=\"text-gray-400 text-xs\">\r\n                    {program.sessions.length} session{program.sessions.length !== 1 ? 's' : ''}\r\n                  </span>\r\n                )}\r\n              </div>\r\n              {program.description && (\r\n                <div className=\"text-gray-400 text-xs mt-2 z-10 line-clamp-2\">{program.description}</div>\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n      <button\r\n        className=\"fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-500 text-white rounded-full w-14 h-14 flex items-center justify-center text-3xl shadow-lg z-50\"\r\n        onClick={() => setShowModal(true)}\r\n        aria-label=\"Add Program\"\r\n      >\r\n        +\r\n      </button>\r\n      <ProgramModal \r\n        isOpen={showModal} \r\n        onClose={() => {\r\n          setShowModal(false);\r\n          setError(null);\r\n        }} \r\n        onSave={handleAdd} \r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst ProgramList: React.FC<{ onSelect?: (id: string) => void }> = (props) => {\r\n  return (\r\n    <ErrorBoundary fallback={<div className=\"text-white p-4\">Error loading programs. Please try again.</div>}>\r\n      <ProgramListContent {...props} />\r\n    </ErrorBoundary>\r\n  );\r\n};\r\n\r\nexport default ProgramList;\r\n"],"names":["levelColors","ProgramListContent","onSelect","navigate","useNavigate","programs","create","refresh","deleteProgram","usePrograms","showModal","setShowModal","useState","error","setError","deletingProgramId","setDeletingProgramId","auth","getAuth","useEffect","handleAdd","data","user","newProgram","createdProgram","p","err","errorMessage","handleDeleteProgram","programId","programName","event","jsxs","jsx","program","e","TrashIcon","ProgramModal","ProgramList","props","ErrorBoundary"],"mappings":"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"}