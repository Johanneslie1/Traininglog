import{j as e,u as I,i as O,k as z}from"./index-oRYx91ZM.js";import{b as r,h as T}from"./react-vendor-DQubVtpq.js";import{E as D,a as F}from"./ExerciseSetLogger-DxgvFKo_.js";import{j as W}from"./firebase-vendor-D8cnFtZG.js";import{F as M}from"./TrashIcon-DAbwCWt1.js";import"./CreateExerciseDialog-BGvh7GMo.js";import"./auth-DlnMWTUc.js";function $(l,h){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:h},l),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"}))}const B=r.forwardRef($);function U(l,h){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:h},l),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"}))}const H=r.forwardRef(U),q=({onClose:l,onSave:h,initialExercises:f=[]})=>{const[a,n]=r.useState("main"),[j,d]=r.useState(f),[c,g]=r.useState(null),u=r.useCallback(i=>{const p=i.id||`temp-${Date.now()}`;g({...i,id:p,sets:[]}),n("setLogger")},[]),v=r.useCallback(i=>{c&&(d(p=>[...p,{...c,sets:i}]),g(null),n("main"))},[c]),b=i=>{d(p=>p.filter(S=>S.id!==i))},m=i=>{i.preventDefault(),h(j)};return a==="search"?e.jsx(D,{onClose:()=>n("main"),onSelectExercise:u}):a==="setLogger"&&c?e.jsx(F,{exercise:c,onSave:v,onCancel:()=>n("main")}):e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Exercises"}),j.length===0&&e.jsx("div",{className:"text-gray-500",children:"No exercises added yet."}),e.jsx("ul",{children:j.map((i,p)=>e.jsxs("li",{className:"flex items-center gap-2 text-gray-200 text-sm mb-1",children:[i.name," - ",i.sets.length," sets",e.jsx("button",{type:"button",onClick:()=>b(i.id),className:"ml-2 text-red-400",children:"Remove"})]},i.id||p))}),e.jsx("button",{type:"button",onClick:()=>n("search"),className:"px-3 py-1 bg-blue-700 text-white rounded",children:"Add Exercise"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 bg-gray-700 text-white rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Save"})]})]})},V=({onClose:l,onSave:h})=>{const[f,a]=r.useState("search"),[n,j]=r.useState(null),[d,c]=r.useState([]),[g,u]=r.useState(null),v=r.useCallback(m=>{try{j({...m,id:crypto.randomUUID(),sets:[]}),c([]),a("setLogger"),u(null)}catch(i){u("Failed to add exercise. Please try again."),console.error("Error adding exercise:",i)}},[]),b=r.useCallback(m=>{if(n)try{c(m),h({...n,sets:m})}catch(i){u("Failed to save exercise. Please try again."),console.error("Error saving exercise:",i)}},[n,h]);return f==="search"?e.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg w-full max-w-4xl flex flex-col h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-medium text-white",children:"Add Exercise"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 m-4 rounded-lg",children:e.jsx("p",{className:"text-red-500",children:g})}),e.jsx(D,{onClose:l,onSelectExercise:v})]})}):f==="setLogger"&&n?e.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg w-full max-w-4xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-medium text-white",children:n.name}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>a("search"),className:"text-gray-400 hover:text-white transition-colors",children:"Change Exercise"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.description&&e.jsx("p",{className:"mt-2 text-gray-400",children:n.description})]}),g&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 mx-4 mt-4 rounded-lg",children:e.jsx("p",{className:"text-red-500",children:g})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(F,{exercise:n,onSave:b,onCancel:l,showPreviousSets:!0,isEditing:!1,previousSet:d.length>0?d[d.length-1]:void 0})})]})}):null},A=({isOpen:l,onClose:h,onSave:f,initialData:a})=>{const[n,j]=r.useState((a==null?void 0:a.name)||""),[d,c]=r.useState((a==null?void 0:a.exercises.map(o=>({id:o.id,name:o.name,description:"",type:"strength",category:"compound",primaryMuscles:[],secondaryMuscles:[],defaultUnit:"kg",metrics:{trackWeight:!0,trackReps:!0},instructions:[],sets:Array(o.sets).fill({reps:o.reps,weight:o.weight||0,difficulty:"MODERATE"})})))||[]),[g,u]=r.useState(!1),[v,b]=r.useState(!1),[m,i]=r.useState(null),p=r.useCallback(()=>{var s;const o=W();if(!((s=o.currentUser)!=null&&s.uid))throw new Error("User must be logged in to perform this action");return o.currentUser.uid},[]),S=o=>{c(s=>[...s,o]),b(!1)},L=o=>{m!==null&&(c(s=>s.map((t,x)=>x===m?{...t,sets:o}:t)),i(null))},P=o=>{c(o),u(!1)},k=o=>{if(o.preventDefault(),!!n)try{const s=p();console.log("[SessionModal] Creating/updating session:",{isEdit:!!a,name:n,exerciseCount:d.length});const t=d.map(w=>{var E,C;return{id:w.id||"",name:w.name,sets:w.sets.length||3,reps:((E=w.sets[0])==null?void 0:E.reps)||10,weight:((C=w.sets[0])==null?void 0:C.weight)||0,setsData:w.sets.map(y=>({reps:y.reps||10,weight:typeof y.weight=="number"?y.weight:0,difficulty:y.difficulty||"MODERATE"}))}}),x={id:(a==null?void 0:a.id)||"",name:n,exercises:t,userId:s,order:(a==null?void 0:a.order)??0};console.log("[SessionModal] Saving session:",x),f(x),j(""),c([]),h()}catch(s){console.error("[SessionModal] Error saving session:",s),alert(s instanceof Error?s.message:"Failed to save session")}};return l?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50",children:[e.jsxs("form",{onSubmit:k,className:"bg-[#23272F] p-6 rounded-lg w-full max-w-sm shadow-lg",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-white",children:"Add Session"}),e.jsx("input",{className:"w-full mb-3 px-3 py-2 rounded bg-[#181A20] text-white border border-white/10",placeholder:"Session Name",value:n,onChange:o=>j(o.target.value),required:!0}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-white mb-2",children:"Exercises"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>b(!0),className:"px-3 py-1 bg-green-700 text-white rounded",children:"Add Exercise"}),e.jsx("button",{type:"button",onClick:()=>u(!0),className:"px-3 py-1 bg-blue-700 text-white rounded",children:"Edit All"})]}),d.length===0&&e.jsx("div",{className:"text-gray-500",children:"No exercises added yet."}),e.jsx("ul",{children:d.map((o,s)=>e.jsxs("li",{className:"text-gray-200 text-sm mb-1 flex items-center gap-2",children:[o.name," - ",o.sets.length," sets",e.jsx("button",{type:"button",className:"text-blue-400 ml-2",onClick:()=>i(s),children:"Edit"}),e.jsx("button",{type:"button",className:"text-red-400 ml-2",onClick:()=>c(t=>t.filter((x,w)=>w!==s)),children:"Remove"})]},o.id||s))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 bg-gray-700 text-white rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Save"})]})]}),g&&e.jsxs(e.Fragment,{children:[typeof m=="number"&&d[m]&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-60",children:e.jsx("div",{className:"bg-[#23272F] p-6 rounded-lg w-full max-w-md shadow-lg",children:e.jsx(F,{exercise:d[m],onSave:L,onCancel:()=>i(null)})})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-60",children:e.jsx("div",{className:"bg-[#23272F] p-6 rounded-lg w-full max-w-md shadow-lg",children:e.jsx(q,{initialExercises:d,onSave:P,onClose:()=>u(!1)})})})]}),v&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-60",children:e.jsx("div",{className:"bg-[#23272F] p-6 rounded-lg w-full max-w-md shadow-lg",children:e.jsx(V,{onSave:S,onClose:()=>b(!1)})})})]}):null},Z=({program:l,onBack:h,onUpdate:f,selectionMode:a=!1})=>{const n=l.sessions??[],[j,d]=r.useState(!1),[c,g]=r.useState(null),[u,v]=r.useState([]),[,b]=r.useState(!1),[m,i]=r.useState(!1),{updateSessionInProgram:p,deleteProgram:S}=I();T.useEffect(()=>{let s;return n.length===0&&(b(!0),s=setTimeout(()=>{b(!1)},2e3)),()=>{s&&clearTimeout(s)}},[n.length]);const L=r.useCallback(s=>{v(t=>t.includes(s)?t.filter(x=>x!==s):[...t,s])},[]),P=r.useCallback(async s=>{if(window.confirm("Are you sure you want to delete this session?"))try{console.log("[ProgramDetail] Deleting session:",s),await O(l.id,s),console.log("[ProgramDetail] Session deleted from Firestore");const t=n.filter(x=>x.id!==s);f({...l,sessions:t}),console.log("[ProgramDetail] Local state updated after session deletion")}catch(t){console.error("Error deleting session:",t),alert(t instanceof Error?t.message:"Failed to delete session. Please try again.")}},[l,n,f]),k=r.useCallback(async s=>{try{if(b(!0),console.log("[ProgramDetail] Starting session save:",{sessionId:s.id,sessionName:s.name,isEdit:!!c,exerciseCount:s.exercises.length}),c){console.log("[ProgramDetail] Updating existing session via updateSession service"),await p(l.id,s.id,s.exercises);const t=n.map(x=>x.id===s.id?{...s,order:x.order}:x);f({...l,sessions:t}),console.log("[ProgramDetail] Local state updated for existing session")}else{console.log("[ProgramDetail] Creating new session via createSession service");const t=n.map(N=>N.order??0),x=t.length>0?Math.max(...t)+1:0,w={name:s.name,exercises:s.exercises.map(N=>({...N,id:N.id||void 0})),order:x},E=await z(l.id,w);console.log("[ProgramDetail] New session created in Firestore with ID:",E);const C={...s,id:E,order:x},y=[...n,C].sort((N,R)=>(N.order??0)-(R.order??0));f({...l,sessions:y}),console.log("[ProgramDetail] Local state updated with new session")}d(!1),g(null),u.includes(s.id)||v(t=>[...t,s.id])}catch(t){console.error("[ProgramDetail] Error saving session:",t),alert(t instanceof Error?t.message:"Failed to save session. Please try again.")}finally{b(!1)}},[l,n,f,c,p,u]),o=async()=>{if(window.confirm(`Are you sure you want to delete the program "${l.name}"? This will delete all sessions and exercises. This action cannot be undone.`)){i(!0);try{console.log("[ProgramDetail] Deleting program:",l.id),await S(l.id),console.log("[ProgramDetail] Program deleted successfully"),h()}catch(s){console.error("[ProgramDetail] Error deleting program:",s),alert(s instanceof Error?s.message:"Failed to delete program. Please try again.")}finally{i(!1)}}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:l.name}),e.jsx("p",{className:"text-gray-400 mt-1",children:l.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!a&&e.jsx("button",{onClick:o,disabled:m,className:"p-2 hover:bg-red-600/20 rounded-lg transition-colors text-red-400 hover:text-red-300 disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete program","aria-label":`Delete program ${l.name}`,children:m?e.jsx("div",{className:"w-6 h-6 border-2 border-red-400 border-t-transparent rounded-full animate-spin"}):e.jsx(M,{className:"w-6 h-6"})}),e.jsx("button",{onClick:h,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsxs("div",{className:"space-y-4",children:[n.length>0?n.map(s=>e.jsxs("div",{className:"bg-[#1a1a1a] rounded-xl overflow-hidden shadow-lg border border-white/5",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#2a2a2a] to-[#222] px-6 py-4 flex items-center justify-between border-b border-white/5",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[s.name,e.jsxs("span",{className:"text-sm font-normal text-gray-400 bg-black/20 px-2 py-0.5 rounded-full",children:[s.exercises.length," exercises"]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[!a&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>g(s),className:"p-2 hover:bg-black/20 rounded-lg transition-colors text-blue-400 hover:text-blue-300",title:"Edit session",children:e.jsx(H,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>P(s.id),className:"p-2 hover:bg-black/20 rounded-lg transition-colors text-red-400 hover:text-red-300",title:"Delete session",children:e.jsx(M,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>L(s.id),className:"p-2 hover:bg-black/20 rounded-lg transition-colors",title:u.includes(s.id)?"Collapse session":"Expand session",children:e.jsx(B,{className:`w-5 h-5 text-gray-400 transition-transform duration-200 ${u.includes(s.id)?"rotate-180":""}`})})]})]}),u.includes(s.id)&&e.jsx("div",{className:"divide-y divide-white/5",children:s.exercises.map(t=>e.jsx("div",{className:"px-6 py-4 hover:bg-white/5 transition-colors",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-400 mt-1",children:[t.sets," sets × ",t.reps," reps",typeof t.weight=="number"&&t.weight>0&&` @ ${t.weight}kg`]})]})})},t.id))})]},s.id)):e.jsx("div",{className:"text-gray-500",children:"No sessions yet."}),!a&&e.jsxs("button",{onClick:()=>d(!0),className:"mt-4 w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Session"]})]}),e.jsx(A,{isOpen:j,onClose:()=>d(!1),onSave:k}),c&&e.jsx(A,{isOpen:!0,onClose:()=>g(null),onSave:k,initialData:c})]})};export{Z as default};
//# sourceMappingURL=ProgramDetail-DRdSUgXx.js.map
