import{j as e,g as q,i as G,k as _,_ as J}from"./index-CwklxJwA.js";import{b as n,h as K}from"./react-vendor-DQubVtpq.js";import{b as W}from"./ExerciseHistoryPicker-BOb1YIKN.js";import{E as T}from"./ExerciseSetLogger-CYZYj5aJ.js";import{j as Q}from"./firebase-vendor-C56ojj1e.js";import{F as $,b as X,P as Y,S as Z}from"./ProgramBuilder-9c_VX2pN.js";import"./CreateExerciseDialog-BzC3l2rX.js";import"./auth-D3eg-LZj.js";import"./localStorageUtils-B-xqxCNH.js";function ee(r,f){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:f},r),n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"}))}const se=n.forwardRef(ee);function te(r,f){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:f},r),n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}))}const re=n.forwardRef(te),ne=({onClose:r,onSave:f,initialExercises:g=[]})=>{const[a,o]=n.useState("main"),[j,x]=n.useState(g),[m,b]=n.useState(null),v=n.useCallback(i=>{const w=i.id||`temp-${Date.now()}`;b({...i,id:w,sets:[]}),o("setLogger")},[]),N=n.useCallback(i=>{m&&(x(w=>[...w,{...m,sets:i}]),b(null),o("main"))},[m]),d=i=>{x(w=>w.filter(S=>S.id!==i))},c=i=>{i.preventDefault(),f(j)};return a==="search"?e.jsx(W,{onClose:()=>o("main"),onSelectExercise:v}):a==="setLogger"&&m?e.jsx(T,{exercise:m,onSave:N,onCancel:()=>o("main")}):e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Exercises"}),j.length===0&&e.jsx("div",{className:"text-gray-500",children:"No exercises added yet."}),e.jsx("ul",{children:j.map((i,w)=>e.jsxs("li",{className:"flex items-center gap-2 text-gray-200 text-sm mb-1",children:[i.name," - ",i.sets.length," sets",e.jsx("button",{type:"button",onClick:()=>d(i.id),className:"ml-2 text-red-400",children:"Remove"})]},i.id||w))}),e.jsx("button",{type:"button",onClick:()=>o("search"),className:"px-3 py-1 bg-blue-700 text-white rounded",children:"Add Exercise"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 bg-gray-700 text-white rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Save"})]})]})},oe=({onClose:r,onSave:f})=>{const[g,a]=n.useState("search"),[o,j]=n.useState(null),[x,m]=n.useState([]),[b,v]=n.useState(null),N=n.useCallback(c=>{try{j({...c,id:crypto.randomUUID(),sets:[]}),m([]),a("setLogger"),v(null)}catch(i){v("Failed to add exercise. Please try again."),console.error("Error adding exercise:",i)}},[]),d=n.useCallback(c=>{if(o)try{m(c),f({...o,sets:c})}catch(i){v("Failed to save exercise. Please try again."),console.error("Error saving exercise:",i)}},[o,f]);return g==="search"?e.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg w-full max-w-4xl flex flex-col h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-medium text-white",children:"Add Exercise"}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),b&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 m-4 rounded-lg",children:e.jsx("p",{className:"text-red-500",children:b})}),e.jsx(W,{onClose:r,onSelectExercise:N})]})}):g==="setLogger"&&o?e.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg w-full max-w-4xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-medium text-white",children:o.name}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>a("search"),className:"text-gray-400 hover:text-white transition-colors",children:"Change Exercise"}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),o.description&&e.jsx("p",{className:"mt-2 text-gray-400",children:o.description})]}),b&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 mx-4 mt-4 rounded-lg",children:e.jsx("p",{className:"text-red-500",children:b})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(T,{exercise:o,onSave:d,onCancel:r,showPreviousSets:!0,isEditing:!1,previousSet:x.length>0?x[x.length-1]:void 0})})]})}):null},z=({isOpen:r,onClose:f,onSave:g,initialData:a})=>{const[o,j]=n.useState((a==null?void 0:a.name)||""),[x,m]=n.useState((a==null?void 0:a.exercises.map(l=>({id:l.id,name:l.name,description:"",type:"strength",category:"compound",primaryMuscles:[],secondaryMuscles:[],defaultUnit:"kg",metrics:{trackWeight:!0,trackReps:!0},instructions:[],sets:Array(l.sets).fill({reps:l.reps,weight:l.weight||0,difficulty:"MODERATE"})})))||[]),[b,v]=n.useState(!1),[N,d]=n.useState(!1),[c,i]=n.useState(null),w=n.useCallback(()=>{var u;const l=Q();if(!((u=l.currentUser)!=null&&u.uid))throw new Error("User must be logged in to perform this action");return l.currentUser.uid},[]),S=l=>{m(u=>[...u,l]),d(!1)},M=l=>{c!==null&&(m(u=>u.map((E,C)=>C===c?{...E,sets:l}:E)),i(null))},D=l=>{m(l),v(!1)},F=l=>{if(l.preventDefault(),!!o)try{const u=w();console.log("[SessionModal] Creating/updating session:",{isEdit:!!a,name:o,exerciseCount:x.length});const E=x.map(y=>{var I,R;return{id:y.id||"",name:y.name,sets:y.sets.length||3,reps:((I=y.sets[0])==null?void 0:I.reps)||10,weight:((R=y.sets[0])==null?void 0:R.weight)||0,setsData:y.sets.map(L=>({reps:L.reps||10,weight:typeof L.weight=="number"?L.weight:0,difficulty:L.difficulty||"MODERATE"}))}}),C={id:(a==null?void 0:a.id)||"",name:o,exercises:E,userId:u,order:(a==null?void 0:a.order)??0};console.log("[SessionModal] Saving session:",C),g(C),j(""),m([]),f()}catch(u){console.error("[SessionModal] Error saving session:",u),alert(u instanceof Error?u.message:"Failed to save session")}};return r?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50",children:[e.jsxs("form",{onSubmit:F,className:"bg-[#23272F] p-6 rounded-lg w-full max-w-sm shadow-lg",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-white",children:"Add Session"}),e.jsx("input",{className:"w-full mb-3 px-3 py-2 rounded bg-[#181A20] text-white border border-white/10",placeholder:"Session Name",value:o,onChange:l=>j(l.target.value),required:!0}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-white mb-2",children:"Exercises"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>d(!0),className:"px-3 py-1 bg-green-700 text-white rounded",children:"Add Exercise"}),e.jsx("button",{type:"button",onClick:()=>v(!0),className:"px-3 py-1 bg-blue-700 text-white rounded",children:"Edit All"})]}),x.length===0&&e.jsx("div",{className:"text-gray-500",children:"No exercises added yet."}),e.jsx("ul",{children:x.map((l,u)=>e.jsxs("li",{className:"text-gray-200 text-sm mb-1 flex items-center gap-2",children:[l.name," - ",l.sets.length," sets",e.jsx("button",{type:"button",className:"text-blue-400 ml-2",onClick:()=>i(u),children:"Edit"}),e.jsx("button",{type:"button",className:"text-red-400 ml-2",onClick:()=>m(E=>E.filter((C,y)=>y!==u)),children:"Remove"})]},l.id||u))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 bg-gray-700 text-white rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Save"})]})]}),b&&e.jsxs(e.Fragment,{children:[typeof c=="number"&&x[c]&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-60",children:e.jsx("div",{className:"bg-[#23272F] p-6 rounded-lg w-full max-w-md shadow-lg",children:e.jsx(T,{exercise:x[c],onSave:M,onCancel:()=>i(null)})})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-60",children:e.jsx("div",{className:"bg-[#23272F] p-6 rounded-lg w-full max-w-md shadow-lg",children:e.jsx(ne,{initialExercises:x,onSave:D,onClose:()=>v(!1)})})})]}),N&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-60",children:e.jsx("div",{className:"bg-[#23272F] p-6 rounded-lg w-full max-w-md shadow-lg",children:e.jsx(oe,{onSave:S,onClose:()=>d(!1)})})})]}):null},ge=({program:r,onBack:f,onUpdate:g,selectionMode:a=!1})=>{const o=r.sessions??[],[j,x]=n.useState(!1),[m,b]=n.useState(!1),[v,N]=n.useState(!1),[d,c]=n.useState(null),[i,w]=n.useState([]),[,S]=n.useState(!1),[M,D]=n.useState(!1),{updateSessionInProgram:F,deleteProgram:l,updateProgram:u}=q();K.useEffect(()=>{let s;return o.length===0&&(S(!0),s=setTimeout(()=>{S(!1)},2e3)),()=>{s&&clearTimeout(s)}},[o.length]);const E=n.useCallback(s=>{w(t=>t.includes(s)?t.filter(h=>h!==s):[...t,s])},[]),C=n.useCallback(async s=>{if(window.confirm("Are you sure you want to delete this session?"))try{console.log("[ProgramDetail] Deleting session:",s),await G(r.id,s),console.log("[ProgramDetail] Session deleted from Firestore");const t=o.filter(h=>h.id!==s);g({...r,sessions:t}),console.log("[ProgramDetail] Local state updated after session deletion")}catch(t){console.error("Error deleting session:",t),alert(t instanceof Error?t.message:"Failed to delete session. Please try again.")}},[r,o,g]),y=n.useCallback(async s=>{try{if(S(!0),console.log("[ProgramDetail] Starting session save:",{sessionId:s.id,sessionName:s.name,isEdit:!!d,exerciseCount:s.exercises.length}),d){console.log("[ProgramDetail] Updating existing session via updateSession service"),await F(r.id,s.id,s.exercises);const t=o.map(h=>h.id===s.id?{...s,order:h.order}:h);g({...r,sessions:t}),console.log("[ProgramDetail] Local state updated for existing session")}else{console.log("[ProgramDetail] Creating new session via createSession service");const t=o.map(k=>k.order??0),h=t.length>0?Math.max(...t)+1:0,P={name:s.name,exercises:s.exercises.map(k=>({...k,id:k.id||void 0})),order:h},O=await _(r.id,P);console.log("[ProgramDetail] New session created in Firestore with ID:",O);const B={...s,id:O,order:h},A=[...o,B].sort((k,p)=>(k.order??0)-(p.order??0));g({...r,sessions:A}),console.log("[ProgramDetail] Local state updated with new session")}x(!1),c(null),i.includes(s.id)||w(t=>[...t,s.id])}catch(t){console.error("[ProgramDetail] Error saving session:",t),alert(t instanceof Error?t.message:"Failed to save session. Please try again.")}finally{S(!1)}},[r,o,g,d,F,i]),I=async()=>{if(window.confirm(`Are you sure you want to delete the program "${r.name}"? This will delete all sessions and exercises. This action cannot be undone.`)){D(!0);try{console.log("[ProgramDetail] Deleting program:",r.id),await l(r.id),console.log("[ProgramDetail] Program deleted successfully"),f()}catch(s){console.error("[ProgramDetail] Error deleting program:",s),alert(s instanceof Error?s.message:"Failed to delete program. Please try again.")}finally{D(!1)}}},R=()=>{N(!0)},L=async s=>{try{const t={...r,...s,updatedAt:new Date().toISOString()};await u(r.id,t),g(t),N(!1)}catch(t){console.error("[ProgramDetail] Error updating program:",t),alert(t instanceof Error?t.message:"Failed to update program. Please try again.")}},U=s=>{c(s),b(!0)},H=async s=>{try{if(S(!0),d){const t={...s,id:d.id,userId:d.userId};await F(r.id,d.id,t.exercises);const h=o.map(P=>P.id===d.id?t:P);g({...r,sessions:h})}else{const t=await J(()=>import("./firebase-vendor-C56ojj1e.js").then(p=>p.H),[]).then(p=>p.getAuth().currentUser);if(!t)throw new Error("User must be logged in");const h={...s,userId:t.uid},P=Math.max(...o.map(p=>p.order??0),0)+1,O={...h,exercises:h.exercises.map(p=>({...p,id:p.id||void 0})),order:P},B=await _(r.id,O),A={...h,id:B,order:P},k=[...o,A].sort((p,V)=>(p.order??0)-(V.order??0));g({...r,sessions:k}),i.includes(A.id)||w(p=>[...p,A.id])}b(!1),c(null)}catch(t){console.error("[ProgramDetail] Error saving session:",t),alert(t instanceof Error?t.message:"Failed to save session. Please try again.")}finally{S(!1)}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:r.name}),e.jsx("p",{className:"text-gray-400 mt-1",children:r.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!a&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:R,className:"p-2 hover:bg-blue-600/20 rounded-lg transition-colors text-blue-400 hover:text-blue-300",title:"Edit program","aria-label":`Edit program ${r.name}`,children:e.jsx(re,{className:"w-6 h-6"})}),e.jsx("button",{onClick:I,disabled:M,className:"p-2 hover:bg-red-600/20 rounded-lg transition-colors text-red-400 hover:text-red-300 disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete program","aria-label":`Delete program ${r.name}`,children:M?e.jsx("div",{className:"w-6 h-6 border-2 border-red-400 border-t-transparent rounded-full animate-spin"}):e.jsx($,{className:"w-6 h-6"})})]}),e.jsx("button",{onClick:f,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsxs("div",{className:"space-y-4",children:[o.length>0?o.map(s=>e.jsxs("div",{className:"bg-[#1a1a1a] rounded-xl overflow-hidden shadow-lg border border-white/5",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#2a2a2a] to-[#222] px-6 py-4 flex items-center justify-between border-b border-white/5",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[s.name,e.jsxs("span",{className:"text-sm font-normal text-gray-400 bg-black/20 px-2 py-0.5 rounded-full",children:[s.exercises.length," exercises"]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[!a&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>U(s),className:"p-2 hover:bg-black/20 rounded-lg transition-colors text-blue-400 hover:text-blue-300",title:"Edit session",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>C(s.id),className:"p-2 hover:bg-black/20 rounded-lg transition-colors text-red-400 hover:text-red-300",title:"Delete session",children:e.jsx($,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>E(s.id),className:"p-2 hover:bg-black/20 rounded-lg transition-colors",title:i.includes(s.id)?"Collapse session":"Expand session",children:e.jsx(se,{className:`w-5 h-5 text-gray-400 transition-transform duration-200 ${i.includes(s.id)?"rotate-180":""}`})})]})]}),i.includes(s.id)&&e.jsx("div",{className:"divide-y divide-white/5",children:s.exercises.map(t=>e.jsx("div",{className:"px-6 py-4 hover:bg-white/5 transition-colors",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-400 mt-1",children:[t.sets," sets × ",t.reps," reps",typeof t.weight=="number"&&t.weight>0&&` @ ${t.weight}kg`]})]})})},t.id))})]},s.id)):e.jsx("div",{className:"text-gray-500",children:"No sessions yet."}),!a&&e.jsxs("button",{onClick:()=>{c(null),b(!0)},className:"mt-4 w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Session"]})]}),v&&e.jsx(Y,{onClose:()=>N(!1),onSave:L,initialProgram:r}),m&&e.jsx(Z,{onClose:()=>{b(!1),c(null)},onSave:H,initialSession:d||void 0}),e.jsx(z,{isOpen:j,onClose:()=>x(!1),onSave:y}),d&&j&&e.jsx(z,{isOpen:!0,onClose:()=>c(null),onSave:y,initialData:d})]})};export{ge as default};
//# sourceMappingURL=ProgramDetail-DkXPoDE9.js.map
