import{R as i,o as D,p as U,a as n,d}from"./index-CwklxJwA.js";import{D as x,m as w,l,E as y,T as u,x as C,G as E,v as N}from"./firebase-vendor-C56ojj1e.js";function h(e=i){const r=e===i?D:U(e);return function(){const{store:o}=r();return o}}const R=h();function S(e=i){const r=e===i?R:h(e);return function(){return r().dispatch}}const F=S();console.log("Auth service initialized with origin:",window.location.origin);let A=!1;const p=e=>({...e,createdAt:e.createdAt instanceof u?e.createdAt.toDate():e.createdAt,updatedAt:e.updatedAt instanceof u?e.updatedAt.toDate():e.updatedAt}),k=async e=>{const{email:r,password:t,firstName:o,lastName:s,role:a}=e;try{const c=await y(n,r,t),{uid:m}=c.user,f=u.now(),g={id:m,email:r,firstName:o,lastName:s,role:a,createdAt:f,updatedAt:f};return await C(l(d,"users",m),g),p(g)}catch(c){throw new Error(c.message)}},H=async e=>{const{email:r,password:t}=e;try{console.log("Attempting to sign in with email:",r);const o=await x(n,r,t),{uid:s}=o.user;console.log("Sign in successful, fetching user data for uid:",s);const a=await w(l(d,"users",s));if(!a.exists())throw console.error("User document not found in Firestore after login"),new Error("User data not found");return console.log("User data retrieved from Firestore"),p(a.data())}catch(o){throw console.error("Login error:",o),new Error(o.message)}},v=()=>new Promise((e,r)=>{try{const t=N(n,()=>{A=!0,t(),e()},o=>{console.error("Auth initialization error:",o),r(o)})}catch(t){console.error("Auth setup error:",t),r(t)}}),P=async()=>{var e,r;try{A||await v();const t=n.currentUser;if(!t)return console.log("No current user found"),null;console.log("Fetching user data for:",t.uid);const o=await w(l(d,"users",t.uid));if(!o.exists())return console.warn("User document not found in Firestore"),await E(n),null;const s=o.data();return console.log("User data retrieved successfully"),{id:t.uid,email:s.email||t.email||"",firstName:s.firstName||"",lastName:s.lastName||"",role:s.role||"athlete",createdAt:((e=s.createdAt)==null?void 0:e.toDate())||new Date,updatedAt:((r=s.updatedAt)==null?void 0:r.toDate())||new Date}}catch(t){return console.error("Error getting user data:",t),null}};export{P as g,H as l,k as r,F as u};
//# sourceMappingURL=auth-D3eg-LZj.js.map
