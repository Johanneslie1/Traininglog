import{n as H,q as K,o as _,T as F,y as Y,t as z,l as C,m as A,z as B,x as G}from"./firebase-vendor-D8cnFtZG.js";import{j as r,d as k,a as X}from"./index-hOws252K.js";import{b as u}from"./react-vendor-DQubVtpq.js";const P=u.createContext(void 0),Q=()=>{const e=u.useContext(P);if(!e)throw new Error("useSupersets must be used within a SupersetProvider");return e},Z="superset_data",ee="exercise_order",W=e=>`${Z}_${e}`,J=e=>`${ee}_${e}`,se=e=>{try{const s=localStorage.getItem(W(e));return s?JSON.parse(s):[]}catch(s){return console.error("Error loading supersets from storage:",s),[]}},q=(e,s)=>{try{localStorage.setItem(W(e),JSON.stringify(s))}catch(t){console.error("Error saving supersets to storage:",t)}},R=(e,s)=>{try{localStorage.setItem(J(e),JSON.stringify(s))}catch(t){console.error("Error saving exercise order to storage:",t)}},te=e=>{try{const s=localStorage.getItem(J(e));return s?JSON.parse(s):[]}catch(s){return console.error("Error loading exercise order from storage:",s),[]}},me=({children:e})=>{const[s,t]=u.useState({isCreating:!1,selectedExercises:[],activeSuperset:null,supersets:[]}),[o,c]=u.useState(""),[l,a]=u.useState([]),g=u.useCallback(n=>{const i=se(n),m=te(n);t(b=>({...b,supersets:i})),a(m),c(n)},[]),x=u.useCallback(n=>{q(n,s.supersets),R(n,l)},[s.supersets,l]);u.useEffect(()=>{o&&q(o,s.supersets)},[s.supersets,o]),u.useEffect(()=>{o&&l.length>0&&R(o,l)},[l,o]);const E=u.useCallback(n=>{a(n),o&&R(o,n)},[o]),d=u.useCallback(()=>{t(n=>({...n,isCreating:!0,selectedExercises:[]}))},[]),p=u.useCallback(()=>{t(n=>({...n,isCreating:!1,selectedExercises:[]}))},[]),S=u.useCallback(n=>{t(i=>({...i,selectedExercises:i.selectedExercises.includes(n)?i.selectedExercises.filter(m=>m!==n):[...i.selectedExercises,n]}))},[]),I=u.useCallback(n=>{if(s.selectedExercises.length<2)return null;const i={id:crypto.randomUUID(),name:n||`Superset ${s.supersets.length+1}`,exerciseIds:s.selectedExercises,order:s.supersets.length};return t(m=>({...m,supersets:[...m.supersets,i],isCreating:!1,selectedExercises:[]})),i},[s.selectedExercises,s.supersets.length]),N=u.useCallback(n=>{t(i=>({...i,supersets:i.supersets.filter(m=>m.id!==n)}))},[]),y=u.useCallback(n=>{t(i=>({...i,supersets:[...i.supersets,n]}))},[]),v=u.useCallback(n=>{t(i=>({...i,supersets:i.supersets.filter(m=>m.id!==n)}))},[]),j=u.useCallback(n=>s.supersets.find(i=>i.exerciseIds.includes(n))||null,[s.supersets]),L=u.useCallback(n=>s.supersets.some(i=>i.exerciseIds.includes(n)),[s.supersets]),D=u.useCallback(n=>{t(i=>({...i,supersets:i.supersets.map(m=>({...m,exerciseIds:m.exerciseIds.filter(b=>b!==n)})).filter(m=>m.exerciseIds.length>1)}))},[]),O=u.useCallback((n,i)=>{t(m=>({...m,supersets:m.supersets.map(b=>b.id===n?{...b,name:i}:b)}))},[]),f=u.useCallback(()=>{t({isCreating:!1,selectedExercises:[],activeSuperset:null,supersets:[]}),a([])},[]),w={state:s,startCreating:d,cancelCreating:p,toggleExerciseSelection:S,createSuperset:I,breakSuperset:N,addSuperset:y,removeSuperset:v,getSupersetByExercise:j,isExerciseInSuperset:L,removeExerciseFromSuperset:D,clearAll:f,loadSupersetsForDate:g,saveSupersetsForDate:x,updateExerciseOrder:E,renameSuperset:O};return r.jsx(P.Provider,{value:w,children:e})},h=[];for(let e=0;e<256;++e)h.push((e+256).toString(16).slice(1));function re(e,s=0){return(h[e[s+0]]+h[e[s+1]]+h[e[s+2]]+h[e[s+3]]+"-"+h[e[s+4]]+h[e[s+5]]+"-"+h[e[s+6]]+h[e[s+7]]+"-"+h[e[s+8]]+h[e[s+9]]+"-"+h[e[s+10]]+h[e[s+11]]+h[e[s+12]]+h[e[s+13]]+h[e[s+14]]+h[e[s+15]]).toLowerCase()}let U;const oe=new Uint8Array(16);function ne(){if(!U){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");U=crypto.getRandomValues.bind(crypto)}return U(oe)}const ce=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$={randomUUID:ce};function V(e,s,t){var c;if($.randomUUID&&!e)return $.randomUUID();e=e||{};const o=e.random??((c=e.rng)==null?void 0:c.call(e))??ne();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,re(o)}const xe=async(e,s,t)=>{try{if(console.log("📝 addExerciseLog called with:",{logData:e,selectedDate:s,existingId:t}),!e.userId)throw new Error("userId is required to save exercise log");const o={...e,timestamp:F.fromDate(s||new Date),deviceId:window.navigator.userAgent,userId:e.userId,sets:Array.isArray(e.sets)?e.sets:[]};console.log("📝 Prepared exercise data:",o);let c,l;if(t){c=C(k,"users",e.userId,"exercises",t),l=t,console.log("📝 Updating existing document:",l);try{const a=C(k,"exerciseLogs",t);(await A(a)).exists()&&(await B(a),console.log("✅ Cleaned up old location document:",t))}catch(a){console.warn("⚠️ Could not clean up old location:",a)}}else c=C(H(k,"users",e.userId,"exercises")),l=c.id,console.log("📝 Creating new document with ID:",l);return await G(c,o),console.log("✅ Exercise saved successfully with ID:",l),l}catch(o){const c=o;throw console.error("❌ Error adding exercise log:",{error:o,code:c.code,message:c.message,userId:e.userId}),c.code==="permission-denied"?new Error("Permission denied. Please check your authentication."):new Error("Failed to add exercise log: "+(c.message||"Unknown error"))}},he=async(e,s)=>{var t,o;try{if(console.log("🗑️ deleteExerciseLog called with:",{logId:e,userId:s}),!s)throw new Error("userId is required to delete exercise log");if(!e)throw new Error("logId is required to delete exercise log");const c=C(k,"users",s,"exercises",e),l=C(k,"exerciseLogs",e);let a=null,g=null;try{a=await A(c),console.log("📄 New path document check:",{exists:a.exists(),userId:a.exists()?(t=a.data())==null?void 0:t.userId:null})}catch(d){console.warn("⚠️ Error checking new path:",d)}try{g=await A(l),console.log("📄 Old path document check:",{exists:g.exists(),userId:g.exists()?(o=g.data())==null?void 0:o.userId:null})}catch(d){console.warn("⚠️ Error checking old path:",d)}let x=!1,E=[];if(a!=null&&a.exists()){const d=a.data();if((d==null?void 0:d.userId)===s)try{await B(c),console.log("✅ Exercise deleted from new location successfully"),x=!0}catch(p){console.error("❌ Failed to delete from new location:",p);const S=p instanceof Error?p.message:"Unknown error";E.push(`New location error: ${S}`)}else d!=null&&d.userId&&console.warn("⚠️ Document exists but belongs to different user:",{docUserId:d.userId,requestUserId:s})}if(!x&&(g!=null&&g.exists())){const d=g.data();if((d==null?void 0:d.userId)===s)try{await B(l),console.log("✅ Exercise deleted from old location successfully"),x=!0}catch(p){console.error("❌ Failed to delete from old location:",p);const S=p instanceof Error?p.message:"Unknown error";E.push(`Old location error: ${S}`)}else d!=null&&d.userId&&console.warn("⚠️ Document exists but belongs to different user:",{docUserId:d.userId,requestUserId:s})}if(!x){const d=!a&&!g?"Could not access exercise document. Please check your permissions.":E.length>0?`Failed to delete exercise: ${E.join("; ")}`:"Exercise log not found or you do not have permission to delete it";throw new Error(d)}}catch(c){throw console.error("❌ Error deleting exercise log:",c),c instanceof Error?c:new Error("Failed to delete exercise log")}},pe=async(e,s,t)=>{try{if(console.log("📖 getExerciseLogs called with:",{userId:e,startDate:s,endDate:t}),!e)throw new Error("userId is required to fetch exercise logs");const o=H(k,"users",e,"exercises"),c=K(o,_("timestamp",">=",F.fromDate(s)),_("timestamp","<=",F.fromDate(t)),Y("timestamp","desc")),a=(await z(c)).docs.map(g=>{const x=g.data();return{id:g.id,exerciseName:x.exerciseName,sets:x.sets,timestamp:x.timestamp.toDate(),deviceId:x.deviceId||"legacy",userId:x.userId}});return console.log("📖 Retrieved exercises:",a.length),a}catch(o){throw console.error("❌ Error fetching exercise logs:",o),new Error("Failed to fetch exercises")}},M="exercise_logs",ae=e=>{const s=new Date(e);s.setHours(0,0,0,0);const t=new Date(e);return t.setHours(23,59,59,999),{startOfDay:s,endOfDay:t}},ie=()=>{let e=localStorage.getItem("device_id");return e||(e=V(),localStorage.setItem("device_id",e)),e},T=()=>{const e=localStorage.getItem(M);if(!e)return[];try{const s=JSON.parse(e);return Array.isArray(s)?s.map(t=>({...t,timestamp:new Date(t.timestamp)})):[]}catch(s){return console.error("Error parsing exercise logs:",s),[]}},fe=e=>{const s=T(),{startOfDay:t,endOfDay:o}=ae(e);return s.filter(c=>{const l=new Date(c.timestamp);return l>=t&&l<=o})},we=e=>{var a;const s=T(),t={...e,id:e.id||V(),deviceId:e.deviceId||ie(),timestamp:e.timestamp||new Date,userId:((a=X.currentUser)==null?void 0:a.uid)||"anonymous"},o={...t,timestamp:t.timestamp instanceof Date?t.timestamp.toISOString():new Date(t.timestamp).toISOString()},c=s.findIndex(g=>g.id===e.id);let l;return c!==-1?l=[...s.slice(0,c),o,...s.slice(c+1)]:l=[...s,o],localStorage.setItem(M,JSON.stringify(l)),t},Ee=e=>{const t=T().filter(o=>o.id!==e);localStorage.setItem(M,JSON.stringify(t))},le=e=>{if(!e)return"var(--color-normal)";switch(e){case"WARMUP":return"var(--color-warmup)";case"EASY":return"var(--color-easy)";case"MODERATE":return"var(--color-moderate)";case"HARD":return"var(--color-hard)";default:return"var(--color-moderate)"}},Se=({exercise:e,onEdit:s,onDelete:t,showActions:o=!0,exerciseNumber:c,subNumber:l})=>{const[a,g]=u.useState(!1),[x,E]=u.useState(!0),d=u.useRef(null),{state:p,toggleExerciseSelection:S,isExerciseInSuperset:I,startCreating:N}=Q(),y=I(e.id||""),v=p.selectedExercises.includes(e.id||"");u.useEffect(()=>{const f=w=>{d.current&&!d.current.contains(w.target)&&g(!1)};return a&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[a]);const j=()=>{e.id&&S(e.id)},L=()=>e.sets.reduce((f,w)=>f+w.weight*w.reps,0),D=()=>{E(!x)},O=`bg-[#1a1a1a] rounded-lg p-3 transition-all duration-200 ${y?"bg-[#2196F3]/5":v?"bg-[#8B5CF6]/10 border-l-2 border-[#8B5CF6]":"hover:bg-black/20"}`;return r.jsxs("div",{className:O,children:[p.isCreating&&r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("input",{type:"checkbox",checked:v,onChange:j,className:"w-4 h-4 text-[#8B5CF6] bg-gray-100 border-gray-300 rounded focus:ring-[#8B5CF6] focus:ring-2"}),r.jsx("span",{className:"text-sm text-gray-400",children:"Select for superset"})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[c&&r.jsxs("div",{className:"flex items-center justify-center min-w-6 h-6 bg-[#8B5CF6] text-white text-xs font-bold rounded-full px-1.5",children:[c,l?String.fromCharCode(96+l):""]}),r.jsx("h3",{className:"text-base font-medium text-white",children:e.exerciseName})]}),o&&r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:D,className:"p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":x?"Hide details":"Show details",children:r.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x?r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"}):r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),r.jsx("button",{onClick:()=>{y||(p.isCreating?j():(N(),e.id&&setTimeout(()=>{S(e.id||"")},50)))},className:`p-2 rounded-lg transition-colors ${y?"bg-[#2196F3] text-white":v?"bg-[#8B5CF6] text-white":"hover:bg-white/10 text-gray-400 hover:text-white"}`,"aria-label":y?"In superset":v?"Selected for superset":"Add to superset",children:y?r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.1a3 3 0 004.24-4.24l-1.1-1.102z"})}):v?r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),s&&r.jsx("button",{onClick:s,className:"p-2 hover:bg-white/10 rounded-lg transition-colors","aria-label":"Edit exercise",children:r.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),t&&r.jsx("button",{onClick:t,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-red-500","aria-label":"Delete exercise",children:r.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m4-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),r.jsx("div",{className:"mt-3",children:x?r.jsx("div",{className:"text-sm",children:r.jsx("div",{className:"flex flex-wrap items-center",children:e.sets.map((f,w)=>r.jsxs("div",{className:"flex items-center",style:{marginRight:w===e.sets.length-1?0:8},children:[r.jsxs("span",{className:"font-medium whitespace-nowrap",style:{color:le(f.difficulty)},children:[f.weight,"kg ",f.reps,"r"]}),w<e.sets.length-1&&r.jsx("span",{className:"text-gray-500 mx-1",children:"|"})]},w))})}):r.jsxs("div",{className:"text-sm text-gray-300",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-gray-400",children:"Sets"}),r.jsx("span",{className:"text-white",children:e.sets.length})]}),r.jsxs("div",{className:"flex items-center justify-between mt-1",children:[r.jsx("span",{className:"text-gray-400",children:"Total Volume"}),r.jsxs("span",{className:"text-white",children:[L(),"kg"]})]})]})})]})};export{Se as E,me as S,xe as a,fe as b,Ee as c,he as d,pe as e,T as g,we as s,Q as u,V as v};
//# sourceMappingURL=ExerciseCard-B7UjJGlB.js.map
