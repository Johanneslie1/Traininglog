<!DOCTYPE html>
<html>
<head>
    <title>Firebase Permission Tester</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body>
    <h1>Firestore Team Creation Tester</h1>
    <button onclick="testTeamCreation()">Test Team Creation</button>
    <pre id="output"></pre>
    
    <script>
        // Initialize Firebase - REPLACE WITH YOUR CONFIG
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "session-logger-3619e.firebaseapp.com",
            projectId: "session-logger-3619e",
            storageBucket: "session-logger-3619e.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        function log(message) {
            const output = document.getElementById('output');
            output.textContent += message + '\n';
            console.log(message);
        }
        
        async function testTeamCreation() {
            try {
                log('=== Starting Test ===');
                
                // Check auth state
                const user = auth.currentUser;
                if (!user) {
                    log('ERROR: Not logged in! Please log in first.');
                    return;
                }
                
                log(`User authenticated: ${user.uid}`);
                log(`User email: ${user.email}`);
                
                // Test data
                const testTeamData = {
                    name: "Test Team",
                    description: "Test Description",
                    coachId: user.uid,
                    coachName: user.email ? user.email.split('@')[0] : 'Coach',
                    inviteCode: "TEST123",
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    isActive: true
                };
                
                log('Test data:');
                log(JSON.stringify(testTeamData, null, 2));
                
                // Try to create team
                log('Attempting to create team...');
                const teamRef = db.collection('teams').doc();
                await teamRef.set(testTeamData);
                
                log(`SUCCESS! Team created with ID: ${teamRef.id}`);
                
                // Clean up - delete test team
                log('Cleaning up test team...');
                await teamRef.delete();
                log('Test team deleted');
                
            } catch (error) {
                log('ERROR: ' + error.message);
                log('Error code: ' + error.code);
                log('Full error:');
                log(JSON.stringify(error, null, 2));
            }
        }
    </script>
</body>
</html>
